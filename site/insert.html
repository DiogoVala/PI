<!DOCTYPE html>
<html>
    <head>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
        <title>Controlo Heatband</title>
        <link rel="stylesheet" href="style.css">    <!-- isto é para ligar ao ficheiro CSS -->
    </head>

    <body>
        <!-- "Cabeçalho" -->
        <div class="row" id="row1" style="z-index: -1;">
            <div class="left_box">
                <img src="azevedos1.png" alt="Azevedos"></div>
            <div class="middle_box">
                <h1 id="title_h1">Termorregulador digital</h1></div>
            <div class="right_box">
                <img src="logo.png" alt="UA">
            </div>
        </div>
        
        <!-- Restante body -->
        <br>

        <div class="wrapper" id="row2">
            <br><br><br>
            <div class="sidebar">
                <ul >
                    <b>
                        <li><a href="insert.html"><i class="fas fa-home"></i>Inserir par&acircmetros</a></li>
                        <li><a href="graf1.html"><i class="fas fa-user"></i>Temperatura</a></li>
                        <li><a href="graf2.html"><i class="fas fa-address-card"></i>Tens&atildeo</a></li>
                        <li><a href="graf3.html"><i class="fas fa-project-diagram"></i>Corrente</a></li>
                    </b>
                </ul> 
            </div>
            
            <div class="main_content">
                <div class="header">
                    <h1>Inserir par&acircmetros</h1> 
                </div> 

                <div class="info">
                    <form class="form" id="myForm">
                        <label for="ip" style="color: black;">IP: </label>
                        <input type="text" id="ip" name="ip">
                        <button onclick="get_ip()" type="submit">Inserir</button>
                        <br>
                        <label for="preheat" style="color: black;">Pr&eacute-aquecimento (&degC): </label>
                        <input type="text" id="preheat" name="preheat">
                        <button onclick="send_preheat()" type="submit">Enviar Valor</button>
                        <br>
                        <label for="seal" style="color: black;">Selagem (&degC):</label>
                        <input type="text" id="seal" name="seal">
                        <button onclick="send_seal()" type="submit">Enviar Valor</button>
                    </form>

                    <script>
                        function send_preheat(){
                            var preheat_value = document.getElementById("preheat").value;
                            localStorage.setItem("preheat_val", preheat_value);
                            var preheat_flag = 1;
                            localStorage.setItem("flag_preheat", preheat_flag);            
                        }

                        function send_seal(){
                            var seal_value = document.getElementById("seal").value;
                            localStorage.setItem("seal_val", seal_value);
                            var seal_flag = 1;
                            localStorage.setItem("flag_seal", seal_flag);
                        }

                        function get_ip(){
                            var ip_value = document.getElementById("ip").value;
                            localStorage.setItem("IpSaved", ip_value);
                            console.log(ip_value);
                        }

                        setInterval(function(){
                            var seal_flag = localStorage.getItem("flag_seal");
                            if(seal_flag==1)
                            {
                                var protocol = "http://";
                                var local_ip = localStorage.getItem("IpSaved");
                                var seal_value = localStorage.getItem("seal_val");
                                submitOK = "true";
                                
                                
                                if (isNaN(seal_value) || seal_value < 0 || seal_value.length ==0) {
                                    alert("A temperatura deve ser um valor positivo");
                                    submitOK = "false";
                                }
                                                         
                                var data = String(protocol)+String(local_ip)+String("/set_seal?")+String(seal_value)

                                if (submitOK == "false") {
                                    return false;
                                }else{
                                    fetch(data)
                                    console.log(data);
                                }
                                seal_flag = 0;
                                localStorage.setItem("flag_seal", seal_flag);
                            }

                            var preheat_flag = localStorage.getItem("flag_preheat");

                            if(preheat_flag == 1)
                            {
                                var protocol = "http://";
                                var local_ip = localStorage.getItem("IpSaved");
                                var preheat_value = localStorage.getItem("preheat_val");
                                submitOK = "true";
                                
                                
                                if (isNaN(preheat_value) || preheat_value < 0 || preheat_value.length ==0) {
                                    alert("A temperatura deve ser um valor positivo");
                                    submitOK = "false";
                                }
                                
                                var data = String(protocol)+String(local_ip)+String("/set_preheat?")+String(preheat_value)

                                if (submitOK == "false") {
                                    return false;
                                }
                                else {
                                    console.log(data);
                                    fetch(data)
                                        .then(function(response) {
                                            return response.text();
                                    })
                                        .then(function(text) {
                                            a = parseInt(text);
                                            console.log(a);
                                    })
                                        .catch(function (error) {
                                            console.log("Error: " + error);
                                    });
                                }
                                preheat_flag = 0;
                                localStorage.setItem("flag_preheat", preheat_flag);  
                            }
                        },100);
                    </script>
                </div>
            </div>
        </div>        
    </body>
</html>